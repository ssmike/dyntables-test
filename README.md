# Здесь постараюсь описать как вообще запускать тесты
### Как поднять
- `docker-compose up` - "поднять" тестовый кластер
- `docker-compose down` - убить кластер и удалить контейнеры
- `docker-compose build` - пересобрать образы(здесь надо обратить внимание на кэш докера если хочется поменять локальные папки с настройками, то опция `--no-cache` не нужна, если хочется другую версию ытя или моего кода, то нужна)
- `docker-compose exec *host* bash` - подключиться к соответствующей ноде (на control запускается jepsen, на n1-n5 запускается ыть)

### Как подбросить свой бинарник
2 способа

- можно указать версию в master/Dockerfile
- положить бинарник в master/master и поменять master/master/run.sh (jepsen запускает ыть скриптом `run.sh` и останавливает скриптом `stop.sh` при запуске контейнеров запускается соответствующий `entrypoint.sh`)

После этого, конечно же, надо пересобрать образы и перезапустить кластер


### Как запустить тесты
Со времен тестов кипариса все поменялось. Теперь надо все собрать в один архив(lein uberjar) и запустить с аргументом test

`... test` как правило делает все что нужно

`... test --help` выдаст более менее все опции которые могут понадобиться

Для того чтобы править логику, надо редактировать код на clojure)

### Где взять логи

Достать логи уже не так просто. И, вообще говоря, способ зависит от GraphDriver'а докера.

На убунте(16.04) это overlayfs и можно сделать `docker inspect control | grep UpperDir`
Полученная директория соответствует корню файловой системы контейнера.
Если драйвер не overlay, то можно либо изучать секцию GraphDriver в выхлопе `docker inspect control`
либо воспользоваться `docker export` и получить тарболл из файловой системы контейнера

`/root/proxy-*.log` - логи прокси на питоне(код находится в соответствующей [репе](https://github.yandex-team.ru/ssmike/yt-proxy))

`/root/store` - логи jepsen'a и логи для всех нод

TODO: разобраться с serve-cmd для просмотра тестов

